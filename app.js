// Personalized News Digest Application
class NewsDigestApp {
    constructor() {
        this.mockNewsData = [
            {
                "id": "1",
                "title": "Revolutionary AI Breakthrough in Natural Language Processing",
                "summary": "Researchers have developed a new AI model that can understand context and nuance in human language with unprecedented accuracy. This breakthrough could transform how we interact with technology in our daily lives, enabling more natural conversations with AI assistants and improving translation services across languages.",
                "fullContent": "In a groundbreaking development, researchers at Stanford University have unveiled a new artificial intelligence model that demonstrates unprecedented accuracy in understanding human language context and nuance. The model, dubbed ContextAI, represents a significant leap forward in natural language processing technology.\n\nThe research team, led by Dr. Sarah Chen, spent three years developing algorithms that can interpret subtle linguistic cues, cultural references, and implied meanings that have traditionally been challenging for AI systems. 'This breakthrough brings us closer to truly conversational AI that understands not just what we say, but what we mean,' Dr. Chen explained.\n\nThe implications for technology are far-reaching. Current applications being tested include enhanced customer service chatbots, more accurate real-time translation services, and AI writing assistants that better understand creative intent. Tech giants Google, Microsoft, and OpenAI have already expressed interest in licensing the technology.\n\nThe model achieved a 94% accuracy rate in context comprehension tests, compared to 76% for existing state-of-the-art systems. This improvement could revolutionize how we interact with smart devices, virtual assistants, and automated systems in our daily lives.",
                "source": "TechCrunch",
                "publishedAt": "2025-08-22T06:30:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400",
                "category": "Technology",
                "url": "https://techcrunch.com/ai-breakthrough-nlp",
                "rating": 0,
                "saved": false
            },
            {
                "id": "2", 
                "title": "Global Markets Surge as Tech Stocks Lead Rally",
                "summary": "Major stock markets worldwide experienced significant gains today, driven primarily by strong performance in technology sectors. Analysts attribute the surge to positive earnings reports from major tech companies and renewed investor optimism about AI and semiconductor growth prospects.",
                "fullContent": "Global financial markets experienced their strongest single-day performance in months, with technology stocks leading a broad-based rally across major exchanges. The S&P 500 gained 2.8%, while the Nasdaq Composite jumped 3.4%, marking the best day for tech stocks since March.\n\nThe surge was triggered by better-than-expected quarterly earnings from semiconductor giant NVIDIA, which reported revenue growth of 45% year-over-year, driven by robust demand for AI chips. Apple also contributed to the rally with strong iPhone sales in emerging markets, while Microsoft's cloud computing division showed accelerated growth.\n\n'We're seeing a perfect storm of positive factors,' said Maria Rodriguez, senior market analyst at Goldman Sachs. 'Strong earnings, improved economic indicators, and growing confidence in AI technologies are all contributing to this rally.'\n\nEuropean markets followed suit, with the FTSE 100 gaining 1.9% and the DAX rising 2.1%. Asian markets had already closed higher, with Tokyo's Nikkei finishing up 2.3% and Hong Kong's Hang Seng index climbing 2.8%.\n\nInvestors are now looking ahead to next week's Federal Reserve meeting, where interest rate decisions could further impact market momentum.",
                "source": "Financial Times",
                "publishedAt": "2025-08-22T05:15:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400",
                "category": "Business",
                "url": "https://ft.com/markets-tech-rally",
                "rating": 0,
                "saved": false
            },
            {
                "id": "3",
                "title": "Championship Finals Set for Epic Weekend Showdown",
                "summary": "Two powerhouse teams will clash in what promises to be the most exciting championship final in recent history. Both teams have shown exceptional form throughout the season, with record-breaking performances that have fans eagerly anticipating this ultimate showdown between titans of the sport.",
                "fullContent": "The stage is set for what many are calling the championship final of the decade, as the New York Thunder and Los Angeles Lightning prepare to face off in a best-of-seven series that begins this weekend. Both teams finished the regular season with identical 58-4 records, setting up a clash between two juggernauts.\n\nThe Thunder, led by MVP candidate Marcus Johnson, have dominated with their high-octane offense, averaging 118 points per game while shooting 48% from three-point range. Their fast-break style has earned them the nickname 'Thunder Strike' among fans.\n\nMeanwhile, the Lightning have built their success on a suffocating defense that allows just 89 points per game, the lowest in league history. Captain Sarah Williams has anchored a defensive unit that has held opponents to under 40% shooting throughout the playoffs.\n\n'This is what every athlete dreams of,' Johnson said at yesterday's press conference. 'Two undefeated teams, both playing at the top of their game. It doesn't get any better than this.'\n\nTickets for the series have broken records, with the cheapest seats selling for over $500. The series will be broadcast globally, with an estimated audience of 200 million viewers expected for Game 1.",
                "source": "ESPN",
                "publishedAt": "2025-08-22T04:45:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400",
                "category": "Sports",
                "url": "https://espn.com/championship-finals-preview",
                "rating": 0,
                "saved": false
            },
            {
                "id": "4",
                "title": "Breakthrough Study Links Mediterranean Diet to Longevity",
                "summary": "A comprehensive 15-year study involving over 100,000 participants shows that following a Mediterranean diet can significantly reduce the risk of cardiovascular disease by 35% and improve overall longevity by up to 8 years. The research provides the strongest evidence yet for dietary lifestyle changes.",
                "fullContent": "A landmark study published in the New England Journal of Medicine has provided the most compelling evidence to date that the Mediterranean diet can significantly extend human lifespan and reduce chronic disease risk. The research, conducted across 12 countries over 15 years, followed 100,847 participants aged 40-75.\n\nLed by Dr. Antonio Martinez from the University of Barcelona, the study found that participants who closely followed a Mediterranean diet had a 35% lower risk of cardiovascular disease, 28% lower risk of type 2 diabetes, and 22% lower risk of certain cancers compared to those following a standard Western diet.\n\nThe Mediterranean diet emphasizes olive oil, fresh fruits and vegetables, whole grains, legumes, nuts, and fish, while limiting red meat and processed foods. 'The results are remarkable,' Dr. Martinez explained. 'We're not just talking about preventing disease, but actually extending healthy lifespan.'\n\nParticipants in the highest adherence group showed biological markers typically associated with being 5-8 years younger than their chronological age. Blood tests revealed lower inflammation markers, better cholesterol profiles, and improved insulin sensitivity.\n\nThe study also tracked cognitive function, finding that Mediterranean diet followers had 40% lower rates of cognitive decline and dementia onset. These findings have prompted several national health organizations to update their dietary guidelines.",
                "source": "Health Journal",
                "publishedAt": "2025-08-22T03:30:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1490645935967-10de6ba17061?w=400",
                "category": "Health",
                "url": "https://healthjournal.com/mediterranean-diet-longevity",
                "rating": 0,
                "saved": false
            },
            {
                "id": "5",
                "title": "Summer Blockbuster Breaks All-Time Box Office Records",
                "summary": "The latest superhero epic has shattered global box office records, earning over $380 million in its opening weekend across 85 countries. Critics and audiences alike have praised the movie's groundbreaking visual effects, compelling storyline, and outstanding performances from an ensemble cast.",
                "fullContent": "Cinema history was made this weekend as 'Heroes United: Infinity War' became the highest-grossing opening weekend in film history, earning $380.2 million globally. The superhero epic surpassed the previous record held by 'Avengers: Endgame' by over $30 million.\n\nDirected by acclaimed filmmaker Ava DuVernay, the film brings together characters from multiple franchises in an unprecedented cinematic event. The movie's success is attributed to its groundbreaking use of virtual production technology, which created seamless integration between practical and digital effects.\n\n'We wanted to push the boundaries of what's possible in cinema,' DuVernay said at the premiere. 'The technology allowed us to create worlds and action sequences that were previously impossible to achieve.'\n\nCritics have praised the film's emotional depth alongside its spectacular action sequences. Rolling Stone's review called it 'a masterpiece that redefines the superhero genre,' while Variety noted its 'perfect balance of spectacle and storytelling.'\n\nAudience scores have been equally impressive, with a 96% approval rating on major review platforms. The film's success has already prompted the studio to fast-track production on two sequels, with filming set to begin next year.\n\nInternational markets contributed significantly to the record-breaking weekend, with particularly strong performances in Asia and Europe.",
                "source": "Variety",
                "publishedAt": "2025-08-22T02:20:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1489599651080-7d5bf0351e71?w=400",
                "category": "Entertainment",
                "url": "https://variety.com/blockbuster-box-office-record",
                "rating": 0,
                "saved": false
            },
            {
                "id": "6",
                "title": "NASA Discovers Potentially Habitable Exoplanet",
                "summary": "Astronomers using the James Webb Space Telescope have identified TOI-715b, a new Earth-like planet orbiting within the habitable zone of a nearby red dwarf star. The discovery represents one of the most promising candidates for potentially supporting life beyond our solar system.",
                "fullContent": "In a discovery that could reshape our understanding of life in the universe, NASA scientists have identified TOI-715b, an Earth-sized exoplanet located just 137 light-years away in the habitable zone of its host star. The planet, discovered using the James Webb Space Telescope, shows several characteristics that make it a prime candidate for supporting liquid water and potentially life.\n\nThe research team, led by Dr. Emily Zhang from NASA's Goddard Space Flight Center, used advanced spectroscopic techniques to analyze the planet's atmosphere and surface conditions. 'TOI-715b is remarkable because it sits in the Goldilocks zone – not too hot, not too cold, but just right for liquid water to exist,' Dr. Zhang explained.\n\nThe planet orbits a red dwarf star called TOI-715, completing one orbit every 19.3 Earth days. Despite this rapid orbit, the planet receives similar amounts of energy from its star as Earth receives from the Sun, thanks to the cooler temperature of red dwarf stars.\n\nSpectroscopic analysis has revealed the presence of water vapor in the planet's atmosphere, along with oxygen and methane – a combination that on Earth is associated with biological processes. 'While we can't definitively say there's life on TOI-715b, the atmospheric composition is incredibly intriguing,' noted co-researcher Dr. Michael Torres.\n\nThe discovery has reinvigorated discussions about the search for extraterrestrial life and has prompted plans for more detailed observations using next-generation telescopes currently in development.",
                "source": "National Geographic",
                "publishedAt": "2025-08-22T01:10:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=400",
                "category": "Science",
                "url": "https://natgeo.com/exoplanet-habitable-discovery",
                "rating": 0,
                "saved": false
            },
            {
                "id": "7",
                "title": "Global Climate Summit Reaches Landmark Agreement",
                "summary": "World leaders at the Copenhagen Climate Summit have reached a historic agreement committing to achieve net-zero emissions by 2040, five years ahead of previous targets. The accord includes binding commitments from 195 countries and a $500 billion annual climate fund.",
                "fullContent": "After two weeks of intense negotiations, the Copenhagen Climate Summit concluded with a landmark agreement that environmental experts are calling the most significant climate accord since the Paris Agreement. The Copenhagen Pact commits 195 countries to achieving net-zero greenhouse gas emissions by 2040, accelerating previous timelines by five years.\n\nThe agreement includes several groundbreaking provisions: a $500 billion annual climate fund to help developing nations transition to clean energy, binding emissions reduction targets for all participating countries, and the establishment of an international carbon monitoring system.\n\n'This agreement represents humanity's commitment to securing a livable planet for future generations,' said Summit President Maria Gonzalez. 'For the first time, we have both the ambition and the financial resources to meet the climate challenge.'\n\nKey commitments include a global phase-out of coal power by 2035, a 50% reduction in methane emissions by 2030, and protection of 40% of Earth's land and oceans by 2040. The agreement also establishes a Global Climate Court with the authority to impose sanctions on countries that fail to meet their commitments.\n\nThe private sector played a crucial role in the negotiations, with over 1,000 major corporations pledging to align their operations with the new targets. Technology companies committed to achieving carbon neutrality in their operations by 2030, while energy companies pledged $2 trillion in clean energy investments over the next decade.",
                "source": "Reuters",
                "publishedAt": "2025-08-22T00:30:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1569163139394-de4e4f43e4e5?w=400",
                "category": "Politics",
                "url": "https://reuters.com/climate-summit-agreement",
                "rating": 0,
                "saved": false
            },
            {
                "id": "8",
                "title": "Quantum Computer Achieves Major Breakthrough in Drug Discovery",
                "summary": "IBM's latest quantum computer has successfully modeled complex protein interactions, leading to the discovery of three potential new treatments for Alzheimer's disease. This achievement marks a significant milestone in quantum computing's practical applications for healthcare.",
                "fullContent": "IBM's quantum computing division has achieved a major breakthrough in pharmaceutical research, using their latest 1,000-qubit quantum processor to model complex protein folding patterns that could lead to new treatments for Alzheimer's disease. The achievement represents the first time quantum computing has produced tangible results in drug discovery.\n\nThe research, conducted in partnership with Roche Pharmaceuticals, focused on modeling the amyloid-beta protein aggregations that are characteristic of Alzheimer's disease. Traditional computers require months or years to perform similar calculations, but IBM's quantum system completed the analysis in just 72 hours.\n\n'This is exactly the kind of problem quantum computing was designed to solve,' explained Dr. James Liu, IBM's Director of Quantum Research. 'The exponential complexity of protein interactions is perfectly suited to quantum processing capabilities.'\n\nThe quantum simulations identified three potential drug compounds that could prevent or reverse amyloid plaque formation in the brain. These compounds are now entering preclinical testing, with human trials potentially beginning within two years – a dramatically accelerated timeline compared to traditional drug development.\n\nThe success has prompted increased investment in quantum computing for healthcare applications. Google, Microsoft, and Amazon have all announced new quantum initiatives focused on drug discovery, while pharmaceutical giants Pfizer and Johnson & Johnson have committed $1 billion each to quantum computing research partnerships.\n\nExperts predict that quantum computing could reduce drug development timelines from 10-15 years to just 3-5 years for certain types of medications.",
                "source": "MIT Technology Review",
                "publishedAt": "2025-08-21T23:30:00Z",
                "urlToImage": "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400",
                "category": "Technology",
                "url": "https://technologyreview.com/quantum-drug-discovery",
                "rating": 0,
                "saved": false
            }
        ];

        this.categories = ["Technology", "Business", "Sports", "Health", "Entertainment", "Science", "Politics"];
        this.frequencies = ["Daily", "Weekly"];
        
        this.currentView = 'all'; // 'all' or 'saved'
        this.currentPage = 'main'; // 'main' or 'detail'
        this.currentArticleId = null;
        this.searchQuery = '';
        this.sortBy = 'newest';
        this.currentShareArticle = null;
        
        // Default settings
        this.settings = {
            interests: ['Technology'],
            frequency: 'Daily'
        };

        this.init();
    }

    init() {
        this.loadSettingsFromStorage();
        this.loadArticleStateFromStorage();
        
        // Initialize immediately without loading state
        this.renderSettingsPanel();
        this.bindEvents();
        this.renderArticles();
        this.updateFeedHeader();
        this.updateSavedCount();
    }

    loadSettingsFromStorage() {
        // Note: localStorage is not available in sandbox, using in-memory storage
        this.settings = {
            interests: ['Technology'],
            frequency: 'Daily'
        };
    }

    saveSettingsToStorage() {
        // Note: localStorage is not available in sandbox
        console.log('Settings saved:', this.settings);
    }

    loadArticleStateFromStorage() {
        // Note: localStorage is not available in sandbox
        console.log('Article state loaded from memory');
    }

    saveArticleStateToStorage() {
        // Note: localStorage is not available in sandbox
        console.log('Article state saved to memory');
    }

    bindEvents() {
        // Use event delegation for better performance and dynamic content
        document.addEventListener('click', (e) => {
            this.handleClick(e);
        });

        // Search input
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.searchQuery = e.target.value;
                this.renderArticles();
            });
        }

        // Sort select
        const sortSelect = document.getElementById('sortSelect');
        if (sortSelect) {
            sortSelect.addEventListener('change', (e) => {
                this.sortBy = e.target.value;
                this.renderArticles();
            });
        }
    }

    handleClick(e) {
        const target = e.target.closest('[data-action]') || e.target;
        
        // Header navigation
        if (target.id === 'headerTitle') {
            e.preventDefault();
            this.navigateToMain();
            return;
        }

        if (target.id === 'backToMainBtn') {
            e.preventDefault();
            this.navigateToMain();
            return;
        }

        // Settings
        if (target.id === 'settingsToggle') {
            e.preventDefault();
            this.toggleSettingsPanel();
            return;
        }

        if (target.id === 'applySettings') {
            e.preventDefault();
            this.applySettings();
            return;
        }

        if (target.id === 'resetSettings') {
            e.preventDefault();
            this.resetSettings();
            return;
        }

        // View toggle
        if (target.id === 'allNewsBtn') {
            e.preventDefault();
            this.switchView('all');
            return;
        }

        if (target.id === 'savedNewsBtn') {
            e.preventDefault();
            this.switchView('saved');
            return;
        }

        // Radio items
        if (target.closest('.radio-item')) {
            const radioItem = target.closest('.radio-item');
            const radioInput = radioItem.querySelector('input[type="radio"]');
            if (radioInput) {
                // Update visual state
                const container = radioItem.closest('.radio-group');
                container.querySelectorAll('.radio-item').forEach(item => {
                    item.classList.remove('selected');
                });
                radioItem.classList.add('selected');
                radioInput.checked = true;
            }
            return;
        }

        // Article title clicks (navigate to detail)
        if (target.hasAttribute('data-article-detail-id')) {
            e.preventDefault();
            const articleId = target.getAttribute('data-article-detail-id');
            this.navigateToDetail(articleId);
            return;
        }

        // Save buttons
        if (target.hasAttribute('data-article-id') || target.closest('[data-article-id]')) {
            e.preventDefault();
            const button = target.hasAttribute('data-article-id') ? target : target.closest('[data-article-id]');
            const articleId = button.getAttribute('data-article-id');
            this.toggleSave(articleId);
            return;
        }

        // Share buttons
        if (target.hasAttribute('data-share-id') || target.closest('[data-share-id]')) {
            e.preventDefault();
            const button = target.hasAttribute('data-share-id') ? target : target.closest('[data-share-id]');
            const articleId = button.getAttribute('data-share-id');
            this.openShareModal(articleId);
            return;
        }

        // Read full buttons
        if (target.hasAttribute('data-read-full-id') || target.closest('[data-read-full-id]')) {
            e.preventDefault();
            const button = target.hasAttribute('data-read-full-id') ? target : target.closest('[data-read-full-id]');
            const articleId = button.getAttribute('data-read-full-id');
            const article = this.mockNewsData.find(a => a.id === articleId);
            if (article && article.url) {
                window.open(article.url, '_blank');
                this.showToast('Opening full article in new tab', 'info');
            }
            return;
        }

        // Star rating
        if (target.hasAttribute('data-rating') || target.closest('[data-rating]')) {
            e.preventDefault();
            const star = target.hasAttribute('data-rating') ? target : target.closest('[data-rating]');
            const articleId = star.getAttribute('data-article-id');
            const rating = parseInt(star.getAttribute('data-rating'));
            this.rateArticle(articleId, rating);
            return;
        }

        // Detail view buttons
        if (target.id === 'detailReadFullBtn') {
            e.preventDefault();
            if (this.currentArticleId) {
                const article = this.mockNewsData.find(a => a.id === this.currentArticleId);
                if (article && article.url) {
                    window.open(article.url, '_blank');
                    this.showToast('Opening full article in new tab', 'info');
                }
            }
            return;
        }

        if (target.id === 'detailSaveBtn') {
            e.preventDefault();
            if (this.currentArticleId) {
                this.toggleSave(this.currentArticleId);
                this.updateDetailView();
            }
            return;
        }

        if (target.id === 'detailShareBtn') {
            e.preventDefault();
            if (this.currentArticleId) {
                this.openShareModal(this.currentArticleId);
            }
            return;
        }

        // Share modal
        if (target.id === 'closeShareModal') {
            e.preventDefault();
            this.closeShareModal();
            return;
        }

        if (target.closest('.modal__backdrop')) {
            this.closeShareModal();
            return;
        }

        // Share platform buttons
        if (target.id === 'copyLinkBtn') {
            e.preventDefault();
            this.copyShareLink();
            return;
        }

        if (target.id === 'shareTwitterBtn') {
            e.preventDefault();
            this.shareOnPlatform('twitter');
            return;
        }

        if (target.id === 'shareFacebookBtn') {
            e.preventDefault();
            this.shareOnPlatform('facebook');
            return;
        }

        if (target.id === 'shareLinkedInBtn') {
            e.preventDefault();
            this.shareOnPlatform('linkedin');
            return;
        }
    }

    navigateToMain() {
        this.currentPage = 'main';
        this.currentArticleId = null;
        this.showMainView();
        this.hideBackButton();
        this.updateHeaderTitle('Personalized News Digest');
    }

    navigateToDetail(articleId) {
        this.currentPage = 'detail';
        this.currentArticleId = articleId;
        this.showDetailView(articleId);
        this.showBackButton();
        
        const article = this.mockNewsData.find(a => a.id === articleId);
        if (article) {
            this.updateHeaderTitle(article.title);
        }
    }

    showMainView() {
        const mainView = document.getElementById('mainFeedView');
        const detailView = document.getElementById('articleDetailView');
        
        if (mainView && detailView) {
            mainView.classList.remove('hidden');
            detailView.classList.add('hidden');
        }
    }

    showDetailView(articleId) {
        const mainView = document.getElementById('mainFeedView');
        const detailView = document.getElementById('articleDetailView');
        
        if (mainView && detailView) {
            mainView.classList.add('hidden');
            detailView.classList.remove('hidden');
            this.renderDetailView(articleId);
        }
    }

    showBackButton() {
        const backBtn = document.getElementById('backToMainBtn');
        if (backBtn) {
            backBtn.style.display = 'inline-flex';
        }
    }

    hideBackButton() {
        const backBtn = document.getElementById('backToMainBtn');
        if (backBtn) {
            backBtn.style.display = 'none';
        }
    }

    updateHeaderTitle(title) {
        const headerTitle = document.getElementById('headerTitle');
        if (headerTitle) {
            const icon = headerTitle.querySelector('i');
            const iconHtml = icon ? icon.outerHTML : '<i class="fas fa-newspaper"></i>';
            
            if (title.length > 50) {
                title = title.substring(0, 47) + '...';
            }
            
            headerTitle.innerHTML = `${iconHtml} ${title}`;
        }
    }

    renderDetailView(articleId) {
        const article = this.mockNewsData.find(a => a.id === articleId);
        if (!article) return;

        // Update detail view elements
        const elements = {
            detailSource: document.getElementById('detailSource'),
            detailDate: document.getElementById('detailDate'),
            detailCategory: document.getElementById('detailCategory'),
            detailTitle: document.getElementById('detailTitle'),
            detailImage: document.getElementById('detailImage'),
            detailSummary: document.getElementById('detailSummary'),
            detailFullContent: document.getElementById('detailFullContent'),
            detailSaveBtn: document.getElementById('detailSaveBtn'),
            detailStarRating: document.getElementById('detailStarRating')
        };

        if (elements.detailSource) elements.detailSource.textContent = article.source;
        if (elements.detailDate) elements.detailDate.textContent = this.formatDate(article.publishedAt);
        if (elements.detailCategory) elements.detailCategory.textContent = article.category;
        if (elements.detailTitle) elements.detailTitle.textContent = article.title;
        if (elements.detailSummary) elements.detailSummary.textContent = article.summary;
        if (elements.detailFullContent) elements.detailFullContent.textContent = article.fullContent;

        if (elements.detailImage) {
            elements.detailImage.src = article.urlToImage;
            elements.detailImage.alt = article.title;
            elements.detailImage.onerror = function() {
                this.style.background = 'var(--color-secondary)';
                this.style.minHeight = '300px';
            };
        }

        this.updateDetailView();
        this.renderDetailStarRating();
    }

    updateDetailView() {
        if (!this.currentArticleId) return;
        
        const article = this.mockNewsData.find(a => a.id === this.currentArticleId);
        if (!article) return;

        const detailSaveBtn = document.getElementById('detailSaveBtn');
        if (detailSaveBtn) {
            if (article.saved) {
                detailSaveBtn.classList.add('active');
                detailSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Saved';
            } else {
                detailSaveBtn.classList.remove('active');
                detailSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Save Article';
            }
        }
    }

    renderDetailStarRating() {
        if (!this.currentArticleId) return;
        
        const article = this.mockNewsData.find(a => a.id === this.currentArticleId);
        if (!article) return;

        const detailStarRating = document.getElementById('detailStarRating');
        if (detailStarRating) {
            detailStarRating.innerHTML = this.renderStarRating(article.id, article.rating);
        }
    }

    renderSettingsPanel() {
        // Render interests checkboxes
        const interestsContainer = document.getElementById('interestsContainer');
        if (interestsContainer) {
            interestsContainer.innerHTML = this.categories.map(category => `
                <div class="checkbox-item">
                    <input type="checkbox" id="interest-${category}" value="${category}" 
                           ${this.settings.interests.includes(category) ? 'checked' : ''}>
                    <label for="interest-${category}">${category}</label>
                </div>
            `).join('');
        }

        // Render frequency radio buttons
        const frequencyContainer = document.getElementById('frequencyContainer');
        if (frequencyContainer) {
            frequencyContainer.innerHTML = this.frequencies.map(frequency => `
                <div class="radio-item ${this.settings.frequency === frequency ? 'selected' : ''}">
                    <input type="radio" id="frequency-${frequency}" name="frequency" value="${frequency}" 
                           ${this.settings.frequency === frequency ? 'checked' : ''}>
                    <label for="frequency-${frequency}">${frequency}</label>
                </div>
            `).join('');
        }
    }

    toggleSettingsPanel() {
        const panel = document.getElementById('settingsPanel');
        if (panel) {
            const isHidden = panel.classList.contains('hidden');
            panel.classList.toggle('hidden');
            this.showToast(isHidden ? 'Settings panel opened' : 'Settings panel closed', 'info');
        }
    }

    applySettings() {
        // Get selected interests
        const selectedInterests = Array.from(document.querySelectorAll('#interestsContainer input[type="checkbox"]:checked'))
            .map(checkbox => checkbox.value);

        // Get selected frequency
        const selectedFrequency = document.querySelector('#frequencyContainer input[type="radio"]:checked')?.value;

        if (selectedInterests.length === 0) {
            this.showToast('Please select at least one interest category.', 'error');
            return;
        }

        this.settings.interests = selectedInterests;
        if (selectedFrequency) {
            this.settings.frequency = selectedFrequency;
        }
        this.saveSettingsToStorage();

        this.renderArticles();
        this.updateFeedHeader();
        this.toggleSettingsPanel();
        this.showToast('Settings updated successfully! Feed refreshed with your preferences.', 'success');
    }

    resetSettings() {
        this.settings = {
            interests: ['Technology'],
            frequency: 'Daily'
        };
        this.renderSettingsPanel();
        this.showToast('Settings reset to default.', 'info');
    }

    switchView(view) {
        this.currentView = view;
        
        // Update button states
        const allNewsBtn = document.getElementById('allNewsBtn');
        const savedNewsBtn = document.getElementById('savedNewsBtn');
        
        if (allNewsBtn && savedNewsBtn) {
            allNewsBtn.classList.toggle('active', view === 'all');
            savedNewsBtn.classList.toggle('active', view === 'saved');
        }

        this.renderArticles();
        this.updateFeedHeader();
        this.showToast(
            view === 'saved' ? 'Showing your saved articles' : 'Showing all news articles',
            'info'
        );
    }

    getFilteredArticles() {
        let filteredArticles = [...this.mockNewsData];

        // Filter by view (all or saved)
        if (this.currentView === 'saved') {
            filteredArticles = filteredArticles.filter(article => article.saved);
        } else {
            // Filter by interests for 'all' view
            filteredArticles = filteredArticles.filter(article => 
                this.settings.interests.includes(article.category)
            );
        }

        // Filter by search query
        if (this.searchQuery.trim()) {
            const query = this.searchQuery.toLowerCase();
            filteredArticles = filteredArticles.filter(article => 
                article.title.toLowerCase().includes(query) ||
                article.summary.toLowerCase().includes(query) ||
                article.source.toLowerCase().includes(query) ||
                article.category.toLowerCase().includes(query)
            );
        }

        // Sort articles
        filteredArticles.sort((a, b) => {
            switch (this.sortBy) {
                case 'oldest':
                    return new Date(a.publishedAt) - new Date(b.publishedAt);
                case 'rating':
                    return (b.rating || 0) - (a.rating || 0);
                case 'newest':
                default:
                    return new Date(b.publishedAt) - new Date(a.publishedAt);
            }
        });

        return filteredArticles;
    }

    renderArticles() {
        const articlesGrid = document.getElementById('articlesGrid');
        const emptyState = document.getElementById('emptyState');
        
        if (!articlesGrid || !emptyState) return;

        const filteredArticles = this.getFilteredArticles();

        if (filteredArticles.length === 0) {
            articlesGrid.style.display = 'none';
            emptyState.classList.remove('hidden');
            return;
        }

        emptyState.classList.add('hidden');
        articlesGrid.style.display = 'grid';

        articlesGrid.innerHTML = filteredArticles.map(article => `
            <article class="article-card">
                <img src="${article.urlToImage}" alt="${article.title}" class="article-image" 
                     onerror="this.style.background='var(--color-secondary)'; this.style.minHeight='200px';">
                <div class="article-content">
                    <div class="article-meta">
                        <span class="article-source">${article.source}</span>
                        <span class="article-date">${this.formatDate(article.publishedAt)}</span>
                    </div>
                    <h3 class="article-title" data-article-detail-id="${article.id}">${article.title}</h3>
                    <p class="article-summary">${article.summary}</p>
                    <div class="article-actions">
                        <div class="action-buttons">
                            <button class="action-btn action-btn--save ${article.saved ? 'active' : ''}" 
                                    data-article-id="${article.id}">
                                <i class="fas fa-bookmark"></i>
                                ${article.saved ? 'Saved' : 'Save'}
                            </button>
                            <button class="action-btn" data-share-id="${article.id}">
                                <i class="fas fa-share"></i>
                                Share
                            </button>
                            <button class="action-btn" data-read-full-id="${article.id}">
                                <i class="fas fa-external-link-alt"></i>
                                Read Full
                            </button>
                        </div>
                        <div class="star-rating">
                            ${this.renderStarRating(article.id, article.rating)}
                        </div>
                    </div>
                </div>
            </article>
        `).join('');

        this.updateSavedCount();
    }

    renderStarRating(articleId, currentRating) {
        return Array.from({length: 5}, (_, i) => {
            const starNumber = i + 1;
            const isActive = currentRating && starNumber <= currentRating;
            return `<i class="fas fa-star star ${isActive ? 'active' : ''}" 
                       data-article-id="${articleId}" data-rating="${starNumber}"></i>`;
        }).join('');
    }

    toggleSave(articleId) {
        const article = this.mockNewsData.find(a => a.id === articleId);
        if (article) {
            article.saved = !article.saved;
            this.saveArticleStateToStorage();
            
            // Immediately update the UI
            if (this.currentPage === 'main') {
                this.renderArticles();
            } else if (this.currentPage === 'detail' && this.currentArticleId === articleId) {
                this.updateDetailView();
            }
            
            this.showToast(
                article.saved ? 'Article saved to your collection!' : 'Article removed from your collection.',
                article.saved ? 'success' : 'info'
            );
        }
    }

    rateArticle(articleId, rating) {
        const article = this.mockNewsData.find(a => a.id === articleId);
        if (article) {
            article.rating = rating;
            this.saveArticleStateToStorage();
            
            // Immediately update the UI
            if (this.currentPage === 'main') {
                this.renderArticles();
            } else if (this.currentPage === 'detail' && this.currentArticleId === articleId) {
                this.renderDetailStarRating();
            }
            
            this.showToast(`Article rated ${rating} ${rating === 1 ? 'star' : 'stars'}!`, 'success');
        }
    }

    openShareModal(articleId) {
        const article = this.mockNewsData.find(a => a.id === articleId);
        if (article) {
            this.currentShareArticle = article;
            const shareLink = `${window.location.origin}${window.location.pathname}?article=${article.id}`;
            const shareLinkInput = document.getElementById('shareLink');
            const shareModal = document.getElementById('shareModal');
            
            if (shareLinkInput) {
                shareLinkInput.value = shareLink;
            }
            if (shareModal) {
                shareModal.classList.remove('hidden');
            }
        }
    }

    closeShareModal() {
        const shareModal = document.getElementById('shareModal');
        if (shareModal) {
            shareModal.classList.add('hidden');
        }
        this.currentShareArticle = null;
    }

    copyShareLink() {
        const shareLinkInput = document.getElementById('shareLink');
        if (shareLinkInput) {
            shareLinkInput.select();
            shareLinkInput.setSelectionRange(0, 99999);
            
            try {
                navigator.clipboard.writeText(shareLinkInput.value).then(() => {
                    this.showToast('Link copied to clipboard!', 'success');
                }).catch(() => {
                    document.execCommand('copy');
                    this.showToast('Link copied to clipboard!', 'success');
                });
            } catch (err) {
                this.showToast('Could not copy link', 'error');
            }
        }
    }

    shareOnPlatform(platform) {
        if (!this.currentShareArticle) return;

        const article = this.currentShareArticle;
        const shareUrl = document.getElementById('shareLink')?.value || window.location.href;
        const text = `Check out this article: ${article.title}`;

        let platformUrl = '';
        switch (platform) {
            case 'twitter':
                platformUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`;
                break;
            case 'facebook':
                platformUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
                break;
            case 'linkedin':
                platformUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`;
                break;
        }

        if (platformUrl) {
            window.open(platformUrl, '_blank', 'width=600,height=400');
            this.showToast(`Sharing on ${platform.charAt(0).toUpperCase() + platform.slice(1)}`, 'info');
        }
    }

    updateFeedHeader() {
        const feedTitle = document.getElementById('feedTitle');
        const articleCount = document.getElementById('articleCount');
        const feedFrequency = document.getElementById('feedFrequency');

        if (!feedTitle || !articleCount || !feedFrequency) return;

        const filteredArticles = this.getFilteredArticles();
        const count = filteredArticles.length;

        if (this.currentView === 'saved') {
            feedTitle.textContent = 'Your Saved Articles';
            articleCount.textContent = `${count} saved ${count === 1 ? 'article' : 'articles'}`;
        } else {
            const interests = this.settings.interests.join(', ');
            feedTitle.textContent = `Latest ${interests} News`;
            articleCount.textContent = `${count} ${count === 1 ? 'article' : 'articles'} found`;
        }

        feedFrequency.textContent = `${this.settings.frequency} Updates`;
    }

    updateSavedCount() {
        const savedCount = this.mockNewsData.filter(article => article.saved).length;
        const savedCountElement = document.getElementById('savedCount');
        if (savedCountElement) {
            savedCountElement.textContent = savedCount;
        }
    }

    formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

        if (diffHours < 1) {
            return 'Just now';
        } else if (diffHours < 24) {
            return `${diffHours} hours ago`;
        } else if (diffDays === 1) {
            return 'Yesterday';
        } else if (diffDays < 7) {
            return `${diffDays} days ago`;
        } else {
            return date.toLocaleDateString();
        }
    }

    showLoadingState() {
        const loadingState = document.getElementById('loadingState');
        const articlesGrid = document.getElementById('articlesGrid');
        const emptyState = document.getElementById('emptyState');
        
        if (loadingState) loadingState.style.display = 'flex';
        if (articlesGrid) articlesGrid.style.display = 'none';
        if (emptyState) emptyState.classList.add('hidden');
    }

    hideLoadingState() {
        const loadingState = document.getElementById('loadingState');
        if (loadingState) {
            loadingState.style.display = 'none';
        }
    }

    showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        if (!toast) return;

        const toastIcon = toast.querySelector('.toast__icon');
        const toastMessage = toast.querySelector('.toast__message');

        if (!toastIcon || !toastMessage) return;

        // Set icon based on type
        let iconClass = '';
        switch (type) {
            case 'success':
                iconClass = 'fas fa-check-circle';
                break;
            case 'error':
                iconClass = 'fas fa-exclamation-circle';
                break;
            case 'info':
            default:
                iconClass = 'fas fa-info-circle';
                break;
        }

        toastIcon.className = `toast__icon ${iconClass}`;
        toastMessage.textContent = message;
        toast.className = `toast toast--${type}`;

        // Hide any existing timeout
        if (this.toastTimeout) {
            clearTimeout(this.toastTimeout);
        }

        // Auto hide after 3 seconds
        this.toastTimeout = setTimeout(() => {
            toast.classList.add('hidden');
        }, 3000);
    }
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.app = new NewsDigestApp();
});